# Primary Tables in AMY

The primary tables used in AMY (that will likely appear in every query) are those that store information on events, persons, memberships, and organizations.  Additional tables provide more information about events, persons, memberships, and organizations.

## Events

`workshops_event` - Primary table for all event data.

### Commonly used fields

* `id` Sequential, automatically assigned integer
* `start` and `end` Event start and end dates
* `slug` Event's unique identifier in the form YYYY-MM-DD-sitename
* `url` Event's website. Typically in the format username.github.io/YYYY-MM-DD-sitename (but not required)
* `host_id` An integer representing the Event Host.  This is linked to the `workshops_organization` table
* Location based fields:
    * `venue` The venue name of the event
    * `address` The street address of the event
    * `latitude` and `longitude` Stored as floating point (decimal) numbers
    * `country` Stored as the [two digit country code](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)
* `contact` A list of email addresses listed as contacts for that workshop
* `completed` A Boolean field to note that all work (including workshop coordination and data entry) is complete.
* `assigned_to_id` The id of the Regional Coordinator or other Carpentries Core Team member assigned to this event. This is linked to the `workshops_person` table.
* `language_id` The integer id of the language used at the workshop. This is not typically recorded. This is linked to the `workshops_language` table
* `open_TTT_applications` Used only for instructor training events
* `adminstrator_id` An integer representing the event organizer.  This is linked to the `workshops_organization` table. Historically any organization could be listed as an administrator. Recent updates to AMY limit this to Data Carpentry, Library Carpentry, Software Carpentry, The Carpentries, or self-organized. This enforcement is at the AMY app level, not at the database level.
* `reg_key` Eventbrite registration key


### Unused fields

* `manual_attendance` We are no longer collecting or recording attendance
* ~~`admin_fee`~~, ~~`invoice_status`~~ We are not recording financial data in AMY
* `repository_last_commit_hash`, `repository_metadata`, `metadata_all_changes`, `metadata_changed` Previously used to store metadata changes
* `instructors_post` `instructors_pre` `learners_longterm` `learners_post` `learners_pre` Previously used to store links to surveys.

## Persons

`workshops_persons` - Primary table for all person data. This includes all individuals, regardless of their role with The Carpentries.

### Commonly used fields

* `id` Sequential, automatically assigned integer
* `personal` `middle` `family` Three fields to hold the individual's name.  Only `personal` is required.
* `email` Individual's primary email address. Used for user log in
* `secondary_email` Alternate email address. Optional.
* `gender` Options are `Prefer not to say (undisclosed)` `Female` `Gender variant / non-conforming` `Male` `Other`.
    * `gender_other` Text if individual selected `Other`
* `may_contact` A boolean field. We may not contact people if this field is false
* `github` Individual's GitHub user id
* `twitter` Individual's Twitter user id
* `orcid` Individual's ORCID iD
* `url` Link to the individual's personal website
* `airport_id` An integer representing the person's self identified nearest.  This is linked to the `workshops_airport` table
* `affiliation` A free text field representing the person's self identified institutional affliation. This is **not** linked to the `workshops_organization` table.
* `occupation` A free text field representing the person's self identified occupation
* `user_notes` Free text field with notes from the individual
* `publish_profile` A boolean field that acknowledges permission to publish the individual's profile on our website pages such as the [Instructors](https://carpentries.org/instructors/), [Trainers](https://carpentries.org/trainers/), or [Maintainers](https://carpentries.org/maintainers/) pages
* `country` Self identified country of residence. Stored as the [two digit country code](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2).
* `lesson_publication_consent` Allows individual to consent to publishing their name associated with lesson contributions. Individual can select publication by name, ORCID iD, or GitHub id, or not consent to publishing their name or identity.

### Less commonly used fields

* `last_login` When the user last logged in (regardless of their activity or permissions)
* `is_superuser` Boolean field to note whether the person is a **superuser**, giving them all administrative privileges
* `created_at` Autogenerated timestamp when the record is created
* `last_updated_at` Autogenerated timestamp when the record was last updated
* `duplication_reviewed_on` Timestamp tracking when a [potential duplicate individual's record was reviewed](https://amy.carpentries.org/reports/duplicate_persons/)
* `is_active` A boolean field.  Only active users are able to log in to AMY
* `data_privacy_agreement` Acknowledges user has read our data policy. Required the first time any user logs in

### Other fields

* `password` Not stored as plain text. Do not use or modify this field for anything.

## Memberships

`workshops_membership` - Stores information about each membership agreement.

* `id` Sequential, automatically assigned integer.
* `variant` Membership type (Gold, Silver, etc.)
* `agreement_start` and `agreement_end` Membership term start and end dates
* `contribution_type` Financial, Person-days, or Other
* `workshops_without_admin_fee_per_agreement` Integer; number of centrally organized workshops allowed
* `self_organized_workshops_per_agreement` Integer; number of self organized workshops allowed. Typically unused as there is no cap on self-organized workshops
* `organization_id` An integer representing the Member organization.  This is linked to the `workshops_organization` table
* `seats_instructor_training` Integer; number of seats allowed in instructor training events in the original contract.
* `additional_instructor_training_seats`  Integer; number of additional seats allowed in instructor training events beyond the original contract.
* `agreement_link` Link to agreement.  Typically a Google doc or folder 
* `registration_code` Code used to unlock registration seats on Eventbrite and complete insturctor training application

## Organizations

`workshops_organization` - Stores all organizations in AMY.

* `id` Sequential, automatically assigned integer.  This is used by the `host_id` and `administrator_id` fields in the `workshops_event` table, and the `organization_id` field in the `workshops_membership` table.
* `domain` Website of the organization
* `fullname` Human friendly name of the organization
* `country` Stored as the [two digit country code](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)

# Additional Tables in AMY

## Badges

* `workshops_badge` Lists all available badges (SWC/DC/LC Instructor, Trainer, etc.)
    * `id` Sequential, automatically assigned integer. This is used by `badge_id` in the `workshops_award` table.
    * `criteria` Description of what this badge is
    * `title` Verbose, human friendly name of badge (e.g., *Software Carpentry Instructor* or *Trainer*)
    * `name` "back-end" badge name (e.g., *swc-instructor*, *trainer*)

* `workshops_award` Connects `workshops_badge` and `workshops_person` tables to show what Badges have been awarded to what Persons
    * `id` Sequential, automatically assigned integer.
    * `awarded` Date the badge was awarded. This is usually the date it was recorded in AMY, not the date the person completed all requirements.
    * `badge_id` An integer representing the badge.  This is linked to the `workshops_badge` table
    * `event_id` An integer representing the event the badge came from.  This is linked to the `workshops_event` table
    * `person_id` An integer representing the person who got the badge.  This is linked to the `workshops_person` table
    * `awarded_by_id` An integer representing the person who awarded the badge (entered it in AMY).  This is linked to the `workshops_person` table

## Roles

* `workshops_role` Lists all available roles (Instructor, Helper, Learner, etc.)
    * `id`  Sequential, automatically assigned integer.
    * `verbose_name`  Verbose, human friendly name of role (e.g., *Workshop host*, *Supporting Instructor*)
    * `name`  "back end" task name (e.g., *workshop-host*, *supporting-instructor*)

* `workshops_task` Connects `workshops_role`, `workshops_event`, and `workshops_person` tables to show what what Persons have served in what Roles at what Events
    * `id`  Sequential, automatically assigned integer.
    * `event_id` An integer representing the event the person was at.  This is linked to the `workshops_event` table
    * `person_id` An integer representing the person who was at the event.  This is linked to the `workshops_person` table
    * `role_id` An integer representing the person's role.  This is linked to the `workshops_person` table
    * `seat_membership_id` Used for Instructor Training Learner role only.  An integer representing the membership this seat was assigned to.
    * `seat_open_training` Used for Instructor Training Learner role only. Boolean field noting whether this was an open (non-member) training seat.

    ** Unused fields ** 
    * `title` 
    * `url`

## Tags

* `workshops_tag` Lists all availabe tags for an Event (SWC, DC, LC, Online, Pilot, Circuits, etc.)
    * `id`  Sequential, automatically assigned integer.
    * `name`  "back end" tag name 
    * `details` Description of what tag is used for
    * `priority` Used to control the sort order in the AMY web interface. Not relevant for any other queries.

* `workshops_event_tags` Connects `workshops_tag` and `workshops_event` to show what Tags have been applied to what Events
    * `id`  Sequential, automatically assigned integer.
    * `event_id` An integer representing the event that got that tag.  This is linked to the `workshops_event` table
    * `tag_id` An integer representing the tag that was assigned to that event.  This is linked to the `workshops_tag` table.


## Training progress

* `workshops_trainingrequirement`  Lists all available steps towards Instructor certification (Training Event, Discussion, etc.)
* `workshops_training_progress` Connects `workshops_trainingrequirement` and `workshops_person` to show what Persons have completed what steps of the checkout process.

More information to come





